let ready=!1,observer=null,cursorEle=null,isBlockActive=!1,isTextActive=!1,isMouseDown=!1,styleTag=null,latestCursorStyle={},mousedownStyleRecover={};const position={x:0,y:0},isServer="undefined"==typeof document,registeredNodeSet=new Set,eventMap=new Map,config=getDefaultConfig();class Utils{static clamp(e,t,r){return Math.min(Math.max(e,t),r)}static isNum(e){return"number"==typeof e||/^\d+$/.test(e)}static getSize(e){return this.isNum(e)?`${e}px`:e}static getDuration(e){return this.isNum(e)?`${e}ms`:`${e}`}static getColor(e){return e}static objectKeys(e){return Object.keys(e)}static style2Vars(e){const t={backdropBlur:"--cursor-bg-blur",backdropSaturate:"--cursor-bg-saturate",background:"--cursor-bg",border:"--cursor-border",durationBackdropFilter:"--cursor-blur-duration",durationBase:"--cursor-duration",durationPosition:"--cursor-position-duration",height:"--cursor-height",radius:"--cursor-radius",scale:"--cursor-scale",width:"--cursor-width",zIndex:"--cursor-z-index"};return this.objectKeys(e).reduce((r,o)=>{let s=e[o];if(void 0===s)return r;const n=["background","border"].includes(o),i=["width","height","radius","backdropBlur"].includes(o),a=o.startsWith("duration");return n&&(s=this.getColor(s)),i&&(s=this.getSize(s)),a&&(s=this.getDuration(s)),{...r,[t[o]||o]:s}},{})}static isMergebleObject(e){return(e=>e&&"object"==typeof e&&!Array.isArray(e))(e)}static mergeDeep(e,...t){if(!t.length)return e;const r=t.shift();return r?(this.isMergebleObject(e)&&this.isMergebleObject(r)&&Utils.objectKeys(r).forEach(t=>{this.isMergebleObject(r[t])?(e[t]||Object.assign(e,{[t]:{}}),this.mergeDeep(e[t],r[t])):Object.assign(e,{[t]:r[t]})}),this.mergeDeep(e,...t)):e}}function getDefaultConfig(){return{blockPadding:"auto",adsorptionStrength:10,className:"ipad-cursor",normalStyle:{width:"20px",height:"20px",radius:"50%",durationBase:"0.23s",durationPosition:"0s",durationBackdropFilter:"0s",background:"rgba(150, 150, 150, 0.2)",scale:1,border:"1px solid rgba(100, 100, 100, 0.1)",zIndex:9999,backdropBlur:"0px",backdropSaturate:"180%"},textStyle:{background:"rgba(100, 100, 100, 0.3)",scale:1,width:"4px",height:"1.2em",border:"0px solid rgba(100, 100, 100, 0)",durationBackdropFilter:"1s",radius:"10px"},blockStyle:{background:"rgba(100, 100, 100, 0.3)",border:"1px solid rgba(100, 100, 100, 0.05)",backdropBlur:"0px",durationBase:"0.23s",durationBackdropFilter:"0.1s",backdropSaturate:"120%",radius:"10px"},mouseDownStyle:{background:"rgba(150, 150, 150, 0.3)",scale:.8}}}function updateCursorStyle(e,t){cursorEle&&("string"==typeof e?(latestCursorStyle[e]=t,t&&cursorEle.style.setProperty(e,t)):Object.entries(e).forEach(([e,t])=>{cursorEle&&cursorEle.style.setProperty(e,t),latestCursorStyle[e]=t}))}function onMousemove(e){position.x=e.clientX,position.y=e.clientY,autoApplyTextCursor(e.target)}function onMousedown(){isMouseDown||!config.enableMouseDownEffect||isBlockActive||(isMouseDown=!0,mousedownStyleRecover={...latestCursorStyle},updateCursorStyle(Utils.style2Vars(config.mouseDownStyle||{})))}function onMouseup(){if(!isMouseDown||!config.enableMouseDownEffect||isBlockActive)return;isMouseDown=!1;const e=mousedownStyleRecover;updateCursorStyle(Utils.objectKeys(Utils.style2Vars(config.mouseDownStyle||{})).reduce((t,r)=>({...t,[r]:e[r]}),{}))}function autoApplyTextCursor(e){var t;if(!isBlockActive&&!isTextActive&&config.enableAutoTextCursor){if(e&&1===e.childNodes.length){const r=e.childNodes[0];if(3===r.nodeType&&""!==(null===(t=r.textContent)||void 0===t?void 0:t.trim()))return e.setAttribute("data-cursor","text"),void applyTextCursor(e)}resetCursorStyle()}}let lastNode=null;const scrollHandler=()=>{const e=document.elementFromPoint(position.x,position.y),t=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0,view:window});e!==lastNode&&lastNode&&t&&lastNode.dispatchEvent(t),lastNode=e};function initCursor(e){isServer||ready||(e&&updateConfig(e),ready=!0,window.addEventListener("mousemove",onMousemove),window.addEventListener("mousedown",onMousedown),window.addEventListener("mouseup",onMouseup),window.addEventListener("scroll",scrollHandler),createCursor(),createStyle(),updateCursorPosition(),updateCursor(),createObserver())}function createObserver(){config.enableAutoUpdateCursor&&(observer=new MutationObserver(function(){updateCursor()})).observe(document.body,{childList:!0,subtree:!0})}function disposeCursor(){ready&&(ready=!1,window.removeEventListener("mousemove",onMousemove),window.removeEventListener("scroll",scrollHandler),cursorEle&&cursorEle.remove(),styleTag&&styleTag.remove(),styleTag=null,cursorEle=null,registeredNodeSet.forEach(e=>unregisterNode(e)),null==observer||observer.disconnect())}function updateConfig(e){var t;return"adsorptionStrength"in e&&(config.adsorptionStrength=Utils.clamp(null!==(t=e.adsorptionStrength)&&void 0!==t?t:10,0,30)),Utils.mergeDeep(config,e)}function createStyle(){if(styleTag)return;const e=`.${config.className.split(/\s+/).join(".")}`;(styleTag=document.createElement("style")).innerHTML=`\n    body, * {\n      cursor: none;\n    }\n    ${e} {\n      --cursor-transform-duration: 0.23s;\n      overflow: hidden;\n      pointer-events: none;\n      position: fixed;\n      left: var(--cursor-x);\n      top: var(--cursor-y);\n      width: var(--cursor-width);\n      height: var(--cursor-height);\n      border-radius: var(--cursor-radius);\n      background-color: var(--cursor-bg);\n      border: var(--cursor-border);\n      z-index: var(--cursor-z-index);\n      font-size: var(--cursor-font-size);\n      backdrop-filter:\n        blur(var(--cursor-bg-blur))\n        saturate(var(--cursor-bg-saturate));\n      transition:\n        width var(--cursor-duration) ease,\n        height var(--cursor-duration) ease,\n        border-radius var(--cursor-duration) ease,\n        border var(--cursor-duration) ease,\n        background-color var(--cursor-duration) ease,\n        left var(--cursor-position-duration) ease,\n        top var(--cursor-position-duration) ease,\n        backdrop-filter var(--cursor-blur-duration) ease,\n        transform var(--cursor-transform-duration) ease;\n      transform:\n        translateX(calc(var(--cursor-translateX, 0px) - 50%))\n        translateY(calc(var(--cursor-translateY, 0px) - 50%))\n        scale(var(--cursor-scale, 1));\n    }\n    ${e}.block-active {\n      --cursor-transform-duration: 0s;\n    }\n    ${e} .lighting {\n      display: none;\n    }\n    ${e}.lighting--on .lighting {\n      display: block;\n      width: 0;\n      height: 0;\n      position: absolute;\n      left: calc(var(--lighting-size) / -2);\n      top: calc(var(--lighting-size) / -2);\n      transform: translateX(var(--lighting-offset-x, 0)) translateY(var(--lighting-offset-y, 0));\n      background-image: radial-gradient(\n        circle at center,\n        rgba(255, 255, 255, 0.1) 0%,\n        rgba(255, 255, 255, 0) 30%\n      );\n      border-radius: 50%;\n    }\n    ${e}.block-active .lighting {\n      width: var(--lighting-size, 20px);\n      height: var(--lighting-size, 20px);\n    }\n  `,document.head.appendChild(styleTag)}function createCursor(){if(isServer)return;cursorEle=document.createElement("div");const e=document.createElement("div");cursorEle.classList.add(config.className),e.classList.add("lighting"),cursorEle.appendChild(e),document.body.appendChild(cursorEle),resetCursorStyle()}function updateCursorPosition(){!isServer&&cursorEle&&(isBlockActive||(updateCursorStyle("--cursor-x",`${position.x}px`),updateCursorStyle("--cursor-y",`${position.y}px`)),window.requestAnimationFrame(updateCursorPosition))}function queryAllTargets(){return isServer||!ready?[]:document.querySelectorAll("[data-cursor]")}function updateCursor(){if(initCursor(),isServer||!ready)return;const e=new Map;queryAllTargets().forEach(t=>{e.set(t,!0),registeredNodeSet.has(t)||registerNode(t)}),registeredNodeSet.forEach(t=>{e.has(t)||unregisterNode(t)})}function registerNode(e){let t=e.getAttribute("data-cursor");registeredNodeSet.add(e),"text"===t&&registerTextNode(e),"block"===t?registerBlockNode(e):registeredNodeSet.delete(e)}function unregisterNode(e){var t;registeredNodeSet.delete(e),null===(t=eventMap.get(e))||void 0===t||t.forEach(({event:t,handler:r})=>{"mouseleave"===t&&r(),e.removeEventListener(t,r)}),eventMap.delete(e),e.style.setProperty("transform","none")}function extractCustomStyle(e){const t=e.getAttribute("data-cursor-style"),r={};return t&&t.split(/(;)/).forEach(e=>{const[t,o]=e.split(":").map(e=>e.trim());r[t]=o}),r}function registerTextNode(e){let t;function r(e){isTextActive=!!e,cursorEle&&(e?cursorEle.classList.add("text-active"):cursorEle.classList.remove("text-active"))}function o(e){t&&clearTimeout(t),r(!0),t=setTimeout(()=>r(!0)),applyTextCursor(e.target)}function s(){t&&clearTimeout(t),t=setTimeout(()=>r(!1)),resetCursorStyle()}e.addEventListener("mouseover",o,{passive:!0}),e.addEventListener("mouseleave",s,{passive:!0}),eventMap.set(e,[{event:"mouseover",handler:o},{event:"mouseleave",handler:s}])}function registerBlockNode(e){const t=e;let r;function o(e){isBlockActive=!!e,cursorEle&&(e?cursorEle.classList.add("block-active"):cursorEle.classList.remove("block-active"))}function s(){var e,s,n;cursorEle&&cursorEle.classList.toggle("lighting--on",!!config.enableLighting),a(!1);const i=t.getBoundingClientRect();r&&clearTimeout(r),o(!0),r=setTimeout(()=>o(!0)),cursorEle&&cursorEle.classList.add("block-active");const u={...config.blockStyle||{}};let l=null!==(e=config.blockPadding)&&void 0!==e?e:0,c=null==u?void 0:u.radius;if("auto"===l){const e=Math.min(i.width,i.height);l=Math.max(2,Math.floor(e/25))}if("auto"===c){const e=Utils.getSize(l),r=window.getComputedStyle(t).borderRadius;c=r.startsWith("0")||"none"===r?"0":`calc(${e} + ${r})`,u.radius=c}updateCursorStyle("--cursor-x",`${i.left+i.width/2}px`),updateCursorStyle("--cursor-y",`${i.top+i.height/2}px`),updateCursorStyle("--cursor-width",`${i.width+2*l}px`),updateCursorStyle("--cursor-height",`${i.height+2*l}px`);const d={...u,...extractCustomStyle(t)};void 0===d.durationPosition&&(d.durationPosition=null!==(s=d.durationBase)&&void 0!==s?s:null===(n=config.normalStyle)||void 0===n?void 0:n.durationBase),updateCursorStyle(Utils.style2Vars(d)),a(!0),t.style.setProperty("transform","translate(var(--translateX), var(--translateY))")}function n(){var e;isBlockActive||s();const r=t.getBoundingClientRect(),o=r.height/2,n=(position.y-r.top-o)/o,i=r.width/2,u=(position.x-r.left-i)/i,l=null!==(e=config.adsorptionStrength)&&void 0!==e?e:10;updateCursorStyle("--cursor-translateX",`${u*(r.width/100*l)}px`),updateCursorStyle("--cursor-translateY",`${n*(r.height/100*l)}px`),a(!1);const c=u*(r.width/100*l),d=n*(r.height/100*l);if(t.style.setProperty("--translateX",`${c}px`),t.style.setProperty("--translateY",`${d}px`),config.enableLighting){const e=3*Math.max(r.width,r.height)*1.2,t=position.x-r.left,o=position.y-r.top;updateCursorStyle("--lighting-size",`${e}px`),updateCursorStyle("--lighting-offset-x",`${t}px`),updateCursorStyle("--lighting-offset-y",`${o}px`)}}function i(){r&&clearTimeout(r),r=setTimeout(()=>o(!1)),resetCursorStyle(),a(!0),t.style.setProperty("transform","translate(0px, 0px)")}function a(e){var r,o,s,n,i,a;const u=e?Utils.getDuration(null!==(a=null!==(n=null!==(o=null===(r=null==config?void 0:config.blockStyle)||void 0===r?void 0:r.durationPosition)&&void 0!==o?o:null===(s=null==config?void 0:config.blockStyle)||void 0===s?void 0:s.durationBase)&&void 0!==n?n:null===(i=null==config?void 0:config.normalStyle)||void 0===i?void 0:i.durationBase)&&void 0!==a?a:"0.23s"):"";t.style.setProperty("transition",u?`all ${u} cubic-bezier(.58,.09,.46,1.46)`:"none")}t.addEventListener("mouseenter",s,{passive:!0}),t.addEventListener("mousemove",n,{passive:!0}),t.addEventListener("mouseleave",i,{passive:!0}),eventMap.set(t,[{event:"mouseenter",handler:s},{event:"mousemove",handler:n},{event:"mouseleave",handler:i}])}function resetCursorStyle(){var e;"auto"===(null===(e=config.normalStyle)||void 0===e?void 0:e.radius)&&(config.normalStyle.radius=config.normalStyle.width),updateCursorStyle(Utils.style2Vars(config.normalStyle||{}))}function applyTextCursor(e){updateCursorStyle(Utils.style2Vars(config.textStyle||{})),updateCursorStyle("--cursor-font-size",window.getComputedStyle(e).fontSize),updateCursorStyle(Utils.style2Vars({...config.textStyle,...extractCustomStyle(e)}))}function customCursorStyle(e){return Object.entries(e).map(([e,t])=>`${e}: ${t}`).join("; ")}function resetCursor(){isBlockActive=!1,isTextActive=!1,resetCursorStyle()}const CursorType={TEXT:"text",BLOCK:"block"},exported={CursorType:CursorType,resetCursor:resetCursor,initCursor:initCursor,updateCursor:updateCursor,disposeCursor:disposeCursor,updateConfig:updateConfig,customCursorStyle:customCursorStyle};export{CursorType,customCursorStyle,exported as default,disposeCursor,initCursor,resetCursor,updateConfig,updateCursor};
